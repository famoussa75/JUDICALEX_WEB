{% extends 'start/base.html' %}
{% block title %}Roles d'audiences{% endblock title %}


{% block content %}
{% load static %}

<div class="page-wrapper" >
    <div style="display: flex; align-items: center; background: var(--Bleu, #143642); padding: 7px 17px; gap: 10px; width: 100%;">
        <span style="color: var(--Blanc, #FFF); font-family: Jost; font-size: 16px; font-weight: 700;">
            Procédures
        </span>
        
        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="17" viewBox="0 0 10 17" fill="none">
            <path d="M2.22229 16.5L7.77771 10.7857L10 8.5L7.77771 6.21433L2.22229 0.5L0 2.78567L5.55543 8.5L0 14.2143L2.22229 16.5Z" fill="white"/>
        </svg> 
        
        <span style="color: var(--Jaune, #DFB23D); font-family: Jost; font-size: 16px; font-weight: 700;">
            Rôle d'audiences
        </span>
    </div>
    
    <style>
        /* ===============================
        Gabarit couleurs Rôles Audience
        =============================== */

        /* Arrière-plan général */
            body {
                background-color: #f7f9fb;
                font-family: "Segoe UI", Roboto, sans-serif;
                color: #143642;
            }

            /* En-tête section */
            .subheader {
                font-size: 1.3rem;
                font-weight: 600;
                color: #143642;
                border-left: 5px solid #DFB23D;
                padding-left: 10px;
            }

            /* Bouton principal */
            .btn-primary {
                background-color: #DFB23D !important;
                border: none;
                color: #143642;
                font-weight: 600;
                border-radius: 8px;
                transition: 0.3s ease;
            }
            .btn-primary:hover {
                background-color: #143642 !important;
                color: #FFF !important;
            }

            /* Input recherche */

            .input-icon .form-control:focus {
                border-color: #143642;
                outline: none;
            }

            /* Cartes */
            .role-card, .card {
                border-radius: 12px;
                border: 1px solid #e5e5e5;
                background-color: #FFF;
                box-shadow: 0 2px 8px rgba(20, 54, 66, 0.08);
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .role-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 12px rgba(20, 54, 66, 0.15);
            }

            /* Titres */
            .role-card h3 a {
                text-decoration: none;
                color: #143642;
                font-weight: 600;
            }
            .role-card h3 a:hover {
                color: #DFB23D;
            }

            /* Badges */
            .badge-outline {
                border: 1px solid #DFB23D;
                color: #143642;
                background-color: #FFF;
                border-radius: 20px;
            }
            .badge.bg-secondary {
                background-color: #143642 !important;
                color: #FFF !important;
            }

            /* Pagination */
            .pagination .page-link {
                border-radius: 6px;
                border: 1px solid #DFB23D;
                color: #143642;
            }
            .pagination .page-item.active .page-link {
                background-color: #DFB23D;
                border-color: #DFB23D;
                color: #143642;
                font-weight: 600;
            }
            .pagination .page-link:hover {
                background-color: #143642;
                color: #FFF;
            }

            /* Nouveau label (étoile) */
            .text-green {
                color: #DFB23D !important;
                font-weight: 600;
            }

          

    </style>
    <style>
        /* ===============================
        Filtres latéraux (Affiner recherche)
        =============================== */

        /* Accordion */
        .accordion-button {
            font-weight: 600;
            background-color: #f9f9f9;
            color: #143642 !important;
            border-top: 1px solid #eee;
            transition: 0.2s ease;
        }
        .accordion-button:not(.collapsed) {
            background-color: #143642;
            color: #FFF !important;
            
        }
        .accordion-item {
            border: none;
        }
        .accordion-body {
            padding-left: 20px;
        }

        /* Labels et titres */
        label, .mb-2 {
            color: #143642;
            font-size: 0.95rem;
            font-weight: 500;
        }


        /* Titres secondaires (DU / AU / Precisez une date) */
        h5 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #143642;
            margin-bottom: 6px;
        }


    </style>

    <div class="page-body" style="font-family: Jost;">
        <div class="container-fluid" style="padding: 0 20px;">

            <div class="row col-md-12">
                <div class="col-12 col-md-3">
                    <!-- Page title -->
                    <div class="page-header d-print-none mb-2">
                        <div class="row align-items-center">
                            <div class="col">
                               
                                <h2 class="page-title">
                                    <!-- Download SVG icon from http://tabler-icons.io/i/align-left -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                        viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <line x1="4" y1="6" x2="20" y2="6" />
                                        <line x1="4" y1="12" x2="14" y2="12" />
                                        <line x1="4" y1="18" x2="18" y2="18" />
                                    </svg>
                                    Affiner la recherche
                                </h2>

                            </div>
                        </div>
                    </div>

                    <form action="" method="get" class="card card-body shadow-sm mb-3 p-3">

                        <!-- Année -->
                        <div class="mb-3">
                          <label class="form-label fw-bold">Années</label>
                          <select name="year" class="form-select mb-2" onchange="this.form.submit()">
                            <option value="" disabled>Années</option>
                            {% for y in available_years %}
                              <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
                            {% endfor %}
                          </select>
                        </div>
                      
                        <div class="accordion" id="accordion-filters">
                      
                          <!-- Par juridiction -->
                          <div class="accordion-item">
                            <h2 class="accordion-header" id="heading-juridiction">
                              <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                      data-bs-target="#collapse-juridiction" aria-expanded="true" style="color:#ab7f3f;">
                                <b>Par juridiction</b>
                              </button>
                            </h2>
                            <div id="collapse-juridiction" class="accordion-collapse collapse show" data-bs-parent="#accordion-filters">
                              <div class="accordion-body">
                      
                              <!-- Cour suprême -->
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="csc-checkbox" name="juridictions_csc"
                                    value="CSC" {% if 'CSC' in selected_juridictions_csc %}checked{% endif %}>
                                <label class="form-check-label fw-bold" for="csc-checkbox">Cour suprême</label>
                            </div>
                            
                            <!-- Cours d'appels -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Cours d'appels</label>
                                <select id="multipleSelect1" multiple placeholder="Sélectionnez des Cours d'appels"
                                        data-search="true" name="juridictions_ca">
                                {% for j in juridictions %}
                                    {% if j.typeTribunal == 'CA' %}
                                    <option value="{{ j.id }}" {% if j.id|stringformat:"s" in selected_juridictions_ca %}selected{% endif %}>
                                        {{ j.name }}
                                    </option>
                                    {% endif %}
                                {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Juridictions spécialisées -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Juridictions spécialisées</label>
                                <select id="multipleSelect2" multiple placeholder="Sélectionnez des juridictions spécialisées"
                                        data-search="true" name="juridictions_js">
                                {% for j in juridictions %}
                                    {% if j.typeTribunal == 'JS' %}
                                    <option value="{{ j.id }}" {% if j.id|stringformat:"s" in selected_juridictions_js %}selected{% endif %}>
                                        {{ j.name }}
                                    </option>
                                    {% endif %}
                                {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Tribunaux de première instance -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Tribunaux de première instance</label>
                                <select id="multipleSelect3" multiple placeholder="Sélectionnez des TPI"
                                        data-search="true" name="juridictions_tpi">
                                {% for j in juridictions %}
                                    {% if j.typeTribunal == 'TPI' %}
                                    <option value="{{ j.id }}" {% if j.id|stringformat:"s" in selected_juridictions_tpi %}selected{% endif %}>
                                        {{ j.name }}
                                    </option>
                                    {% endif %}
                                {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Justice de paix -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Justice de paix</label>
                                <select id="multipleSelect4" multiple placeholder="Sélectionnez des JP"
                                        data-search="true" name="juridictions_jp">
                                {% for j in juridictions %}
                                    {% if j.typeTribunal == 'JP' %}
                                    <option value="{{ j.id }}" {% if j.id|stringformat:"s" in selected_juridictions_jp %}selected{% endif %}>
                                        {{ j.name }}
                                    </option>
                                    {% endif %}
                                {% endfor %}
                                </select>
                            </div>
  
                              </div>
                            </div>
                          </div>
                      
                          <!-- Par date -->
                          <div class="accordion-item">
                            <h2 class="accordion-header" id="heading-date">
                              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                      data-bs-target="#collapse-date" aria-expanded="false" style="color:#ab7f3f;">
                                <b>Par date</b>
                              </button>
                            </h2>
                            <div id="collapse-date" class="accordion-collapse collapse" data-bs-parent="#accordion-filters">
                              <div class="accordion-body">
                      
                                <div class="mb-3">
                                  <label class="form-label fw-bold">Date précise</label>
                                  <input type="date" class="form-control mb-2" id="filtreDate" name="filtreDate" value="{{ filtre_date }}">
                                </div>
                      
                                <div class="mb-3">
                                  <label class="form-label fw-bold">Période</label>
                                  <div class="row g-2">
                                    <div class="col-md-6">
                                      <input type="date" class="form-control" id="start-date" name="start_date" value="{{ start_date }}">
                                    </div>
                                    <div class="col-md-6">
                                      <input type="date" class="form-control" id="end-date" name="end_date" value="{{ end_date }}">
                                    </div>
                                  </div>
                                </div>
                      
                              </div>
                            </div>
                          </div>
                      
                          <!-- Par président -->
                          <div class="accordion-item">
                            <h2 class="accordion-header" id="heading-president">
                              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                      data-bs-target="#collapse-president" aria-expanded="false" style="color:#ab7f3f;">
                                <b>Par président</b>
                              </button>
                            </h2>
                            <div id="collapse-president" class="accordion-collapse collapse" data-bs-parent="#accordion-filters">
                              <div class="accordion-body">
                      
                                <div class="mb-3">
                                  <label class="form-label fw-bold">Présidents</label>
                                  <select id="multipleSelect5" multiple placeholder="Sélectionnez des présidents" name="presidents[]" data-search="true">
                                    {% for p in presidents %}
                                      <option value="{{ p.prenomNom }}" {% if p.prenomNom in selected_presidents %}selected{% endif %}>{{ p.prenomNom }}</option>
                                    {% endfor %}
                                  </select>
                                </div>
                      
                              </div>
                            </div>
                          </div>
                      
                        </div>
                      
                        <!-- Boutons -->
                        <div class="d-flex justify-content-between mt-3">
                          <a href="{% url 'role.index' %}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-counterclockwise"></i> Réinitialiser
                          </a>
                          <button type="submit" class="btn btn-primary">
                            <i class="bi bi-funnel"></i> Filtrer
                          </button>
                        </div>
                      
                      </form>
                      
                     
                      
                    

                    <!-- Page title -->
                              
                </div>
                <div class="col-12 col-md-7">
                    <div class="row align-items-center" style="margin-bottom: 55px; margin-top: 3px;">
                        <div class="col">
                            <div class="d-flex align-items-center mb-1">
                                <div class="subheader">Trouvez un rôle d'audience</div>

                            </div>
                            <div class="my-2 my-md-0 flex-grow-1 flex-md-grow-0 order-first order-md-last">
                                <form action="{% url 'role.search' %}" method="GET">
                                    <div class="row input-icon">
                                        <div class="col-md-10">
                                            <input type="text" value="{{ query }}" class="form-control" name="q"
                                                placeholder="Saisissez un mot clé…">
                                        </div>
                                        <div class="col-md-2">
                                            <button type="submit" class="btn btn-primary d-none d-sm-inline-block"
                                                data-bs-toggle="modal" data-bs-target="#modal-report" style="background-color: #ab7f3f;">
                                                <!-- Download SVG icon from http://tabler-icons.io/i/search -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                    height="24" viewBox="0 0 24 24" stroke-width="2"
                                                    stroke="currentColor" fill="none" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                    <circle cx="10" cy="10" r="7" />
                                                    <line x1="21" y1="21" x2="15" y2="15" />
                                                </svg>
                                                Rechercher
                                            </button>
                                        </div>


                                    </div>
                                </form>
                            </div>
                        </div>
                        <!-- Page title actions -->

                    </div>

                    <div id="loader" class="loader"></div>

                    <div class="row row-cards animate-bottom" style="display:none;" id="myDiv">
                                            
                        {% if roles %}
                            
                        <h2 class="">
                            <!-- Download SVG icon from http://tabler-icons.io/i/sort-descending -->
	                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="6" x2="13" y2="6" /><line x1="4" y1="12" x2="11" y2="12" /><line x1="4" y1="18" x2="11" y2="18" /><polyline points="15 15 18 18 21 15" /><line x1="18" y1="6" x2="18" y2="18" /></svg>
                            Tous les rôles
                        </h2>

                       
                            
                        <div class="space-y" id="roles-container" >                              
                            {% for role in roles %}  
                                                              
                                <div class="card role-card" data-juridiction-id="{{ role.juridiction_id }}" data-date="{{role.dateEnreg}}" data-president="{{role.president}}">
                                    <div class="row g-0">
                                        <div class="col-auto">
                                            <div class="card-body">
                                                <div class="avatar avatar-md"
                                                    style="background-image: url(./static/jobs/job-2.png)"> <i class="fa fa-balance-scale"></i></div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body ps-0">
                                                <div class="row">
                                                    <div class="col">
                                                     {% if user.is_authenticated %}
                                                        <h3 class="mb-0"><a  href="{% url 'role.detail' role.idRole %}">{{role.juridiction}} - Rôle du {{role.dateEnreg}}</a></h3>
                                                    {% else %}
                                                        <h3 class="mb-0"><a  href="#" data-bs-toggle="modal" data-bs-target="#modal-login">{{role.juridiction}} - Rôle du {{role.dateEnreg}}</a></h3>
                                                    {% endif %}
                                                    </div>
                                                    <div class="col-auto fs-4 text-green">
                                                       
                                                        
                                                        {% if role.created_at|date:"Y-m-d" == today %}
                                                           <!-- Download SVG icon from http://tabler-icons.io/i/star -->
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" /></svg>
                                                            Nouveau
                                                        {% endif %}
                                             
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md">
                                                        <div
                                                            class="mt-3 list-inline list-inline-dots mb-0 text-secondary d-sm-block d-none">
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/user -->
                                                                <b>Président(e) :</b> {{role.president}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                
                                                                <b>Section :</b> {{role.get_section_display}}
                                                            </div>
                                                           
                                                        </div>
                                                       
                                                    </div>
                                                    <div class="col-md-auto">
                                                        <div class="mt-3 badges">
                                                           
                                                            <a href="#"
                                                                class="badge badge-outline text-secondary fw-normal badge-pill" style="font-size:small;padding: 10px;">
                                                                {% for key, value in total_affaire_items %}
                                                                    {% if key == role.id %}
                                                                    {{ value }} Affaires <br>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </a>
                                                            
                                                           
                                                        </div>
                                                        
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="mt-3 badges">
                                                           
                                                        <span
                                                            class="badge  fw-normal badge-pill" style="font-size:small;padding: 10px;">
                                                            {{ role.get_typeAudience_display }}
                                                        </span>
                                                        
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                            {% endfor %}

                            
                        
                            <!-- Pagination -->
                            <div class="card">
                                <div class="card-body">
                                    <ul class="pagination">
                                        {% if roles.has_previous %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ roles.previous_page_number }}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" 
                                                         viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" 
                                                         stroke-linecap="round" stroke-linejoin="round">
                                                         <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                         <polyline points="15 6 9 12 15 18" />
                                                    </svg>
                                                    Précédent
                                                </a>
                                            </li>
                                        {% endif %}
                                    
                                        {# Toujours afficher la première page #}
                                        {% if roles.number > 3 %}
                                            <li class="page-item"><a class="page-link" href="?page=1">1</a></li>
                                            {% if roles.number > 4 %}
                                                <li class="page-item disabled"><span class="page-link">...</span></li>
                                            {% endif %}
                                        {% endif %}
                                    
                                        {# Afficher 2 pages avant et après la page courante #}
                                        {% for num in roles.paginator.page_range %}
                                            {% if num >= roles.number|add:"-2" and num <= roles.number|add:"2" %}
                                                {% if num == roles.number %}
                                                    <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                                {% else %}
                                                    <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                                {% endif %}
                                            {% endif %}
                                        {% endfor %}
                                    
                                        {# Toujours afficher la dernière page #}
                                        {% if roles.number < roles.paginator.num_pages|add:"-2" %}
                                            {% if roles.number < roles.paginator.num_pages|add:"-3" %}
                                                <li class="page-item disabled"><span class="page-link">...</span></li>
                                            {% endif %}
                                            <li class="page-item"><a class="page-link" href="?page={{ roles.paginator.num_pages }}">{{ roles.paginator.num_pages }}</a></li>
                                        {% endif %}
                                    
                                        {% if roles.has_next %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ roles.next_page_number }}">
                                                    Suivant
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" 
                                                         viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" 
                                                         stroke-linecap="round" stroke-linejoin="round">
                                                         <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                                         <polyline points="9 6 15 12 9 18" />
                                                    </svg>
                                                </a>
                                            </li>
                                        {% endif %}
                                    </ul>
                                    
                                
                                </div>
                            </div>
                           
                        </div>
                       

                        {% endif %}


                        {% if results %}
                            
                       <!-- A afficher lorsque la recherche est finis-->
                        <div class="page-header d-print-none mb-2">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h2 class="page-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <circle cx="10" cy="10" r="7" />
                                            <line x1="21" y1="21" x2="15" y2="15" />
                                        </svg>
                                        Resultats trouvés pour '{{query}}'
                                    </h2>
                                    <div class="text-muted mt-1"> {{ roleSearch|length }} rôle(s) et {{ affaireSearch|length }} affaire(s)</div>
                                </div>
                            </div>
                        </div>
                            
                        <div class="space-y">                              
                            {% for role in results %} 
                            
                                 <!-- si le tableau contient des roles -->
                                {% if role.idRole %}
                                <div class="card  role-card" data-juridiction-id="{{ role.juridiction_id }}"  data-date="{{role.dateEnreg}}" data-president="{{role.president}}">
                                    <div class="row g-0">
                                        <div class="col-auto">
                                            <div class="card-body">
                                                <div class="avatar avatar-md"
                                                    style="background-image: url(./static/jobs/job-2.png)"><i class="fa fa-balance-scale"></i></div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body ps-0">
                                                <div class="row">
                                                    <div class="col">
                                                        
                                                        {% if user.is_authenticated %}
                                                            <h3 class="mb-0"><a  href="{% url 'role.detail' role.idRole %}">{{ role.colored_juridiction|safe }} - Rôle du {{role.colored_dateEnreg|safe}}</a></h3>
                                                        {% else %}
                                                            <h3 class="mb-0"><a  href="#" data-bs-toggle="modal" data-bs-target="#modal-login">{{ role.colored_juridiction|safe }} - Rôle du {{role.colored_dateEnreg|safe}}</a></h3>
                                                        {% endif %}
                                                            
                                                    </div>
                                                    <div class="col-auto fs-4 text-green">
                                                        {% if role.created_at|date:"Y-m-d" == today %}
                                                        <!-- Download SVG icon from http://tabler-icons.io/i/star -->
                                                         <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" /></svg>
                                                         Nouveau
                                                     {% endif %}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md">
                                                        <div
                                                            class="mt-3 list-inline list-inline-dots mb-0 text-secondary d-sm-block d-none">
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/user -->
                                                                <b>Président(e) :</b> {{role.colored_president|safe}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                
                                                                <b>Section :</b> {{role.colored_section|safe}}
                                                            </div>
                                                           
                                                        </div>
                                                       
                                                    </div>
                                                    <div class="col-md-auto">
                                                        <div class="mt-3 badges">
                                                           
                                                            <a href="#"
                                                                class="badge badge-outline text-secondary fw-normal badge-pill" style="font-size:small;padding: 10px;">
                                                                {% for key, value in total_affaire_items %}
                                                                    {% if key == role.id %}
                                                                    {{ value }} Affaires <br>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </a>
                                                           
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- si le tableau contient des affaires -->
                                {% if role.role_id %}
                                <div class="card">
                                    <div class="row g-0">
                                        <div class="col-auto">
                                            <div class="card-body">
                                                <div class="avatar avatar-md"
                                                    style="background-image: url(./static/jobs/job-2.png)"><i class="fa fa-suitcase"></i></div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body ps-0">
                                                <div class="row">
                                                    <div class="col">
                                                         {% if user.is_authenticated %}
                                                            
                                                            {% if role.colored_demandeurs and role.colored_defendeurs %}
                                                            <h3 class="mb-0"><a href="{% url 'role.detail' role.role.idRole %}">{{ role.colored_demandeurs|safe }}  <mark>c/</mark> {{ role.colored_defendeurs|safe }} <span class="text-info">{{ role.role.juridiction }} </span> </a></h3>
                                                            {% endif %}

                                                        {% else %}
                                                            <h3 class="mb-0"><a  href="#" data-bs-toggle="modal" data-bs-target="#modal-login">{{ role.colored_demandeurs|safe }} <!--&nbsp;<span class="badge bg-secondary text-light">demandeur</span>&nbsp; --> <mark>c/</mark> {{ role.colored_defendeurs|safe }} <!-- <span class="badge bg-secondary text-light">defendeur</span>&nbsp; [ {{ role.colored_partie3|safe }} ] --></a></h3>
                                                        {% endif %}
                                                    </div>
                                                    <div class="col-auto fs-4 text-green">
                                                        {% if role.created_at|date:"Y-m-d" == today %}
                                                        <!-- Download SVG icon from http://tabler-icons.io/i/star -->
                                                         <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" /></svg>
                                                         Nouveau
                                                     {% endif %}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md">
                                                        <div
                                                            class="mt-3 list-inline list-inline-dots mb-0 text-secondary d-sm-block d-none">
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/user -->
                                                                <b>Numero RG/RP :</b> {{role.colored_numRg|safe}} {{role.colored_numRp|safe}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                <b>Objet :</b> {{role.colored_objet|safe}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                
                                                                <b>Affaire au rôle du :</b> {{role.role.dateEnreg}}
                                                            </div>
                                                           
                                                        </div>
                                                       
                                                    </div>
                                                  
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {% endif %}
                                    
                             
                            {% endfor %}

                           <!-- Pagination results -->
                            <div class="card">
                                <div class="card-body">
                                <ul class="pagination">
                                    {% if results.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ results.previous_page_number }}&q={{ query }}">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <polyline points="15 6 9 12 15 18" />
                                        </svg>
                                        Précédent
                                        </a>
                                    </li>
                                    {% endif %}
                            
                                    {# Toujours afficher la première page #}
                                    {% if results.number > 3 %}
                                    <li class="page-item"><a class="page-link" href="?page=1&q={{ query }}">1</a></li>
                                    {% if results.number > 4 %}
                                        <li class="page-item disabled"><span class="page-link">...</span></li>
                                    {% endif %}
                                    {% endif %}
                            
                                    {# Afficher 2 pages avant et après la page courante #}
                                    {% for num in results.paginator.page_range %}
                                    {% if num >= results.number|add:"-2" and num <= results.number|add:"2" %}
                                        {% if num == results.number %}
                                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                                        {% else %}
                                        <li class="page-item"><a class="page-link" href="?page={{ num }}&q={{ query }}">{{ num }}</a></li>
                                        {% endif %}
                                    {% endif %}
                                    {% endfor %}
                            
                                    {# Toujours afficher la dernière page #}
                                    {% if results.number < results.paginator.num_pages|add:"-2" %}
                                    {% if results.number < results.paginator.num_pages|add:"-3" %}
                                        <li class="page-item disabled"><span class="page-link">...</span></li>
                                    {% endif %}
                                    <li class="page-item"><a class="page-link" href="?page={{ results.paginator.num_pages }}&q={{ query }}">{{ results.paginator.num_pages }}</a></li>
                                    {% endif %}
                            
                                    {% if results.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ results.next_page_number }}&q={{ query }}">
                                        Suivant
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                                            <polyline points="9 6 15 12 9 18" />
                                        </svg>
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                                </div>
                            </div>
  
                           
                        </div>
                        {% endif %}
                        
                        {% if results|length == 0 and query|length > 0 %}
                          <h2 style="text-align: center;"><i class="fa fa-info-circle"></i> Aucun résultat trouvé pour '{{ query }}'.</h2>
                        {% endif %}
                            
                    </div>


                </div>

                <div class="col-12 col-md-2"> <!-- supprime padding horizontal -->
                    {% include 'start/partials/pub_lateral.html' %}
                </div>
            </div>
        </div>
    </div>

</div>
<script src="{% static 'start/assets/dist/js/virtual-select.min.js' %}"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {

            document.getElementById("link_procedure").classList.add("active");
  
    });
</script>

 <!-- Initialisation VirtualSelect pour les selects multiples -->
 <script>
    const selects = ['multipleSelect1','multipleSelect2','multipleSelect3','multipleSelect4','multipleSelect5'];
    selects.forEach(id => {
      VirtualSelect.init({
        ele: `#${id}`,
        multiple: true,
        search: true,
        width: '100%',
        placeholder: document.querySelector(`#${id}`).getAttribute('placeholder'),
        selectAllText: 'Tout sélectionner'
      });
    });
  </script>


{% endblock %}