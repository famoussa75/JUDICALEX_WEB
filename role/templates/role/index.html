{% extends 'start/base.html' %}
{% block title %}Roles d'audiences{% endblock title %}


{% block content %}
{% load static %}

<div class="page-wrapper" >
    <div style="display: flex; align-items: center; background: var(--Bleu, #143642); padding: 7px 17px; gap: 10px; width: 100%;">
        <span style="color: var(--Blanc, #FFF); font-family: Jost; font-size: 16px; font-weight: 700;">
            Procédures
        </span>
        
        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="17" viewBox="0 0 10 17" fill="none">
            <path d="M2.22229 16.5L7.77771 10.7857L10 8.5L7.77771 6.21433L2.22229 0.5L0 2.78567L5.55543 8.5L0 14.2143L2.22229 16.5Z" fill="white"/>
        </svg> 
        
        <span style="color: var(--Jaune, #DFB23D); font-family: Jost; font-size: 16px; font-weight: 700;">
            Rôle d'audiences
        </span>
    </div>
    
    <style>
        /* ===============================
        Gabarit couleurs Rôles Audience
        =============================== */

        /* Arrière-plan général */
            body {
                background-color: #f7f9fb;
                font-family: "Segoe UI", Roboto, sans-serif;
                color: #143642;
            }

            /* En-tête section */
            .subheader {
                font-size: 1.3rem;
                font-weight: 600;
                color: #143642;
                border-left: 5px solid #DFB23D;
                padding-left: 10px;
            }

            /* Bouton principal */
            .btn-primary {
                background-color: #DFB23D !important;
                border: none;
                color: #143642;
                font-weight: 600;
                border-radius: 8px;
                transition: 0.3s ease;
            }
            .btn-primary:hover {
                background-color: #143642 !important;
                color: #FFF !important;
            }

            /* Input recherche */

            .input-icon .form-control:focus {
                border-color: #143642;
                outline: none;
            }

            /* Cartes */
            .role-card, .card {
                border-radius: 12px;
                border: 1px solid #e5e5e5;
                background-color: #FFF;
                box-shadow: 0 2px 8px rgba(20, 54, 66, 0.08);
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .role-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 6px 12px rgba(20, 54, 66, 0.15);
            }

            /* Titres */
            .role-card h3 a {
                text-decoration: none;
                color: #143642;
                font-weight: 600;
            }
            .role-card h3 a:hover {
                color: #DFB23D;
            }

            /* Badges */
            .badge-outline {
                border: 1px solid #DFB23D;
                color: #143642;
                background-color: #FFF;
                border-radius: 20px;
            }
            .badge.bg-secondary {
                background-color: #143642 !important;
                color: #FFF !important;
            }

            /* Pagination */
            .pagination .page-link {
                border-radius: 6px;
                border: 1px solid #DFB23D;
                color: #143642;
            }
            .pagination .page-item.active .page-link {
                background-color: #DFB23D;
                border-color: #DFB23D;
                color: #143642;
                font-weight: 600;
            }
            .pagination .page-link:hover {
                background-color: #143642;
                color: #FFF;
            }

            /* Nouveau label (étoile) */
            .text-green {
                color: #DFB23D !important;
                font-weight: 600;
            }

          

    </style>
    <style>
        /* ===============================
        Filtres latéraux (Affiner recherche)
        =============================== */

        /* Accordion */
        .accordion-button {
            font-weight: 600;
            background-color: #f9f9f9;
            color: #143642 !important;
            border-top: 1px solid #eee;
            transition: 0.2s ease;
        }
        .accordion-button:not(.collapsed) {
            background-color: #143642;
            color: #FFF !important;
            
        }
        .accordion-item {
            border: none;
        }
        .accordion-body {
            padding-left: 20px;
        }

        /* Labels et titres */
        label, .mb-2 {
            color: #143642;
            font-size: 0.95rem;
            font-weight: 500;
        }


        /* Titres secondaires (DU / AU / Precisez une date) */
        h5 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #143642;
            margin-bottom: 6px;
        }


    </style>

    <div class="page-body" style="font-family: Jost;">
        <div class="container-fluid" style="padding: 0 20px;">

            <div class="row col-md-12">
                <div class="col-md-3 col-lg-3">
                    <!-- Page title -->
                    <div class="page-header d-print-none mb-2">
                        <div class="row align-items-center">
                            <div class="col">
                                <label for="">Année</label>
                                <span>
                                    <form method="get" action="">
                                        <select name="year" class="form-select" onchange="this.form.submit()">
                                          <option value="" disabled>Années</option>
                                          {% for y in available_years %}
                                            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
                                          {% endfor %}
                                        </select>
                                      </form>
                                </span> 
                                <h2 class="page-title mt-3">
                                    <!-- Download SVG icon from http://tabler-icons.io/i/align-left -->
                                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                        viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                        <line x1="4" y1="6" x2="20" y2="6" />
                                        <line x1="4" y1="12" x2="14" y2="12" />
                                        <line x1="4" y1="18" x2="18" y2="18" />
                                    </svg>
                                    Affiner la recherche
                                </h2>

                            </div>
                        </div>
                    </div>
                    <form action="" method="get">


                        <div class="card card-body" style="padding: 0px;">

                            <div class="accordion" id="accordion-example">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading-1">
                                        <button class="accordion-button " type="button" data-bs-toggle="collapse"
                                            data-bs-target="#collapse-1" aria-expanded="true" style="color:#ab7f3f">
                                            <b>Par juridiction</b>
                                        </button>
                                    </h2>
                                    <div id="collapse-1" class="accordion-collapse collapse show"
                                        data-bs-parent="#accordion-example">
                                        <div class="accordion-body pt-0">
                                            <div class="mt-2 mb-2">Choisissez</div>
                                            <div class="mb-3">

                                                <label class="form-check mb-3"
                                                    style="color:gray;border:solid 1px;border-color:#d1d1d1;height: 33px;max-width: 250px; padding-top:5px; padding-left:30px">
                                                    <div>
                                                        {% for j in juridictions  %}
                                                        
                                                            {% if j.typeTribunal == 'CSC'%}
                                                                <input class="form-check-input juridiction-checkbox" type="checkbox" value="{{j.id}}" id="juridiction-{{j.id}}">
                                                                
                                                            {% endif %}                                                          
                                                        
                                                        {% endfor %}
                                                       
                                                        <span class="form-check-label">Cour suprême</span>
                                                    </div>
                                                </label>

                                                <select id="multipleSelect1" multiple name="native-select"
                                                    placeholder="Cours d'appels" data-search="true"
                                                    data-silent-initial-value-set="true" class="mb-3">
                                                    
                                                    {% for j in juridictions  %}
                                                        
                                                        {% if j.typeTribunal == 'CA'%}
                                                            <option  value="{{j.id}}" >{{j.name}}</option>
                                                        {% endif %}                                                          
                                                        
                                                    {% endfor %}
                                                                                                        
                                                </select>

                                                <select id="multipleSelect2" multiple name="native-select"
                                                    placeholder="Juridictions spécialisées" data-search="true"
                                                    data-silent-initial-value-set="true" class="mb-3">
                                                    {% for j in juridictions  %}
                                                        
                                                        {% if j.typeTribunal == 'JS'%}
                                                            <option value="{{j.id}}">{{j.name}}</option>
                                                        {% endif %}                                                          
                                                    
                                                     {% endfor %}
                                                </select>

                                                <select id="multipleSelect3" multiple name="native-select"
                                                    placeholder="Tribunaux de première instance" data-search="true"
                                                    data-silent-initial-value-set="true" class="mb-3">
                                                    {% for j in juridictions  %}
                                                        
                                                        {% if j.typeTribunal == 'TPI'%}
                                                            <option value="{{j.id}}">{{j.name}}</option>
                                                        {% endif %}                                                          
                                                
                                                    {% endfor %}
                                                </select>

                                                <select id="multipleSelect4" multiple name="native-select"
                                                    placeholder="Justice de paix" data-search="true"
                                                    data-silent-initial-value-set="true">
                                                    {% for j in juridictions  %}
                                                        
                                                        {% if j.typeTribunal == 'JP'%}
                                                            <option value="{{j.id}}">{{j.name}}</option>
                                                        {% endif %}                                                          
                                                
                                                    {% endfor %}
                                                </select>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading-2">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapse-2" aria-expanded="false"
                                            style="color:#ab7f3f">
                                            <b>Par date</b>
                                        </button>
                                    </h2>
                                    <div id="collapse-2" class="accordion-collapse collapse"
                                        data-bs-parent="#accordion-example">
                                        <div class="accordion-body pt-0">
                                            <!-- <div class="subheader mb-2">Choisissez</div> -->
                                            <div class="mb-3">
                                                <!-- <label class="form-check mb-1">
                                                    <input type="radio" class="form-check-input" name="form-stars"
                                                        value="5 stars">
                                                    <span class="form-check-label">Aujourd'hui</span>
                                                </label>
                                                <label class="form-check mb-4">
                                                    <input type="radio" class="form-check-input" name="form-stars"
                                                        value="4 stars">
                                                    <span class="form-check-label">Semaine Derniere</span>
                                                </label> -->
                                                <div class=" mb-2 mt-2">Precisez une date</div>
                                                <div class="input-icon mb-4">
                                                    <span class="input-icon-addon">
                                                        <!-- Download SVG icon from http://tabler-icons.io/i/calendar -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                            height="24" viewBox="0 0 24 24" stroke-width="2"
                                                            stroke="currentColor" fill="none" stroke-linecap="round"
                                                            stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                            <rect x="4" y="5" width="16" height="16" rx="2" />
                                                            <line x1="16" y1="3" x2="16" y2="7" />
                                                            <line x1="8" y1="3" x2="8" y2="7" />
                                                            <line x1="4" y1="11" x2="20" y2="11" />
                                                            <line x1="11" y1="15" x2="12" y2="15" />
                                                            <line x1="12" y1="15" x2="12" y2="18" />
                                                        </svg>
                                                    </span>
                                                    <input type="date" class="form-control" placeholder="Selectonner une date"
                                                        id="filtreDate"  />
                                                </div>
                                                <div class=" mb-2 mt-2">Periode</div>
                                                <h5>du</h5>
                                                <div class="input-icon">

                                                    <span class="input-icon-addon">
                                                        <!-- Download SVG icon from http://tabler-icons.io/i/calendar -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                            height="24" viewBox="0 0 24 24" stroke-width="2"
                                                            stroke="currentColor" fill="none" stroke-linecap="round"
                                                            stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                            <rect x="4" y="5" width="16" height="16" rx="2" />
                                                            <line x1="16" y1="3" x2="16" y2="7" />
                                                            <line x1="8" y1="3" x2="8" y2="7" />
                                                            <line x1="4" y1="11" x2="20" y2="11" />
                                                            <line x1="11" y1="15" x2="12" y2="15" />
                                                            <line x1="12" y1="15" x2="12" y2="18" />
                                                        </svg>
                                                    </span>
                                                    <input class="form-control" placeholder="Date de debut" id="start-date" type="date" />
                                                </div><br>
                                                <h5>au</h5>
                                                <div class="input-icon">
                                                    <span class="input-icon-addon">
                                                        <!-- Download SVG icon from http://tabler-icons.io/i/calendar -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                            height="24" viewBox="0 0 24 24" stroke-width="2"
                                                            stroke="currentColor" fill="none" stroke-linecap="round"
                                                            stroke-linejoin="round">
                                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                            <rect x="4" y="5" width="16" height="16" rx="2" />
                                                            <line x1="16" y1="3" x2="16" y2="7" />
                                                            <line x1="8" y1="3" x2="8" y2="7" />
                                                            <line x1="4" y1="11" x2="20" y2="11" />
                                                            <line x1="11" y1="15" x2="12" y2="15" />
                                                            <line x1="12" y1="15" x2="12" y2="18" />
                                                        </svg>
                                                    </span>
                                                    <input class="form-control" placeholder="Date de fin" id="end-date" type="date" />
                                                </div>


                                            </div>

                                        </div>
                                    </div>
                                </div>

                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="heading-4">
                                        <button class="accordion-button collapsed" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#collapse-4" aria-expanded="false"
                                            style="color:#ab7f3f">
                                            <b>Par president</b>
                                        </button>
                                    </h2>
                                    <div id="collapse-4" class="accordion-collapse collapse"
                                        data-bs-parent="#accordion-example">
                                        <div class="accordion-body pt-0">
                                            <div class="mt-2 mb-2">Choisissez</div>
                                            <div class="mb-3">
                                                <select id="multipleSelect5" multiple name="native-select"
                                                    placeholder="Présidents" data-search="true"
                                                    data-silent-initial-value-set="true" class="mb-3">
                                                    {% for p in presidents  %}
                                                        <option value="{{p.prenomNom}}">{{p.prenomNom}}</option>
                                                     {% endfor %}
                                                </select>

                                            </div>


                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <!-- <div class="mt-3">
                            <a href="#" class="btn btn-link w-100">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                    viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                    <path d="M4.05 11a8 8 0 1 1 .5 4m-.5 5v-5h5" />
                                </svg>
                                Reinitialiser
                            </a>
                        </div> -->

                    </form>
                    <!-- Page title -->
                              
                </div>
                <div class="col-md-7 col-lg-7">
                    <div class="row align-items-center" style="margin-bottom: 55px; margin-top: 3px;">
                        <div class="col">
                            <div class="d-flex align-items-center mb-1">
                                <div class="subheader">Trouver un rôle d'audience</div>

                            </div>
                            <div class="my-2 my-md-0 flex-grow-1 flex-md-grow-0 order-first order-md-last">
                                <form action="{% url 'role.search' %}" method="GET">
                                    <div class="row input-icon">
                                        <div class="col-md-10">
                                            <input type="text" class="form-control" name="q"
                                                placeholder="Saisissez un mot clé…">
                                        </div>
                                        <div class="col-md-2">
                                            <button type="submit" class="btn btn-primary d-none d-sm-inline-block"
                                                data-bs-toggle="modal" data-bs-target="#modal-report" style="background-color: #ab7f3f;">
                                                <!-- Download SVG icon from http://tabler-icons.io/i/search -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24"
                                                    height="24" viewBox="0 0 24 24" stroke-width="2"
                                                    stroke="currentColor" fill="none" stroke-linecap="round"
                                                    stroke-linejoin="round">
                                                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                                    <circle cx="10" cy="10" r="7" />
                                                    <line x1="21" y1="21" x2="15" y2="15" />
                                                </svg>
                                                Rechercher
                                            </button>
                                        </div>


                                    </div>
                                </form>
                            </div>
                        </div>
                        <!-- Page title actions -->

                    </div>

                    <div id="loader" class="loader"></div>

                    <div class="row row-cards animate-bottom" style="display:none;" id="myDiv">
                                            
                        {% if roles %}
                            
                        <h2 class="">
                            <!-- Download SVG icon from http://tabler-icons.io/i/sort-descending -->
	                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="4" y1="6" x2="13" y2="6" /><line x1="4" y1="12" x2="11" y2="12" /><line x1="4" y1="18" x2="11" y2="18" /><polyline points="15 15 18 18 21 15" /><line x1="18" y1="6" x2="18" y2="18" /></svg>
                            Tous les rôles
                        </h2>

                       
                            
                        <div class="space-y" id="roles-container" >                              
                            {% for role in roles %}  
                                                              
                                <div class="card role-card" data-juridiction-id="{{ role.juridiction_id }}" data-date="{{role.dateEnreg}}" data-president="{{role.president}}">
                                    <div class="row g-0">
                                        <div class="col-auto">
                                            <div class="card-body">
                                                <div class="avatar avatar-md"
                                                    style="background-image: url(./static/jobs/job-2.png)"> <i class="fa fa-balance-scale"></i></div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body ps-0">
                                                <div class="row">
                                                    <div class="col">
                                                     {% if user.is_authenticated %}
                                                        <h3 class="mb-0"><a  href="{% url 'role.detail' role.idRole %}">{{role.juridiction}} - Rôle du {{role.dateEnreg}}</a></h3>
                                                    {% else %}
                                                        <h3 class="mb-0"><a  href="#" data-bs-toggle="modal" data-bs-target="#modal-login">{{role.juridiction}} - Rôle du {{role.dateEnreg}}</a></h3>
                                                    {% endif %}
                                                    </div>
                                                    <div class="col-auto fs-4 text-green">
                                                       
                                                        
                                                        {% if role.created_at|date:"Y-m-d" == today %}
                                                           <!-- Download SVG icon from http://tabler-icons.io/i/star -->
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" /></svg>
                                                            Nouveau
                                                        {% endif %}
                                             
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md">
                                                        <div
                                                            class="mt-3 list-inline list-inline-dots mb-0 text-secondary d-sm-block d-none">
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/user -->
                                                                <b>Président(e) :</b> {{role.president}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                
                                                                <b>Section :</b> {{role.section}}
                                                            </div>
                                                           
                                                        </div>
                                                       
                                                    </div>
                                                    <div class="col-md-auto">
                                                        <div class="mt-3 badges">
                                                           
                                                            <a href="#"
                                                                class="badge badge-outline text-secondary fw-normal badge-pill" style="font-size:small;padding: 10px;">
                                                                {% for key, value in total_affaire_items %}
                                                                    {% if key == role.id %}
                                                                    {{ value }} Affaires <br>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </a>
                                                            
                                                           
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}

                            <!-- Pagination -->
                            <div class="card">
                                <div class="card-body">
                                  <ul class="pagination ">
                                    {% if roles.has_previous %}
                                    
                                     <li class="page-item">
                                        <a class="page-link" href="?page={{ roles.previous_page_number }}" tabindex="-1" aria-disabled="true">
                                          <!-- Download SVG icon from http://tabler-icons.io/i/chevron-left -->
                                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="15 6 9 12 15 18" /></svg>
                                          précédent
                                        </a>
                                      </li>
                                    {% endif %}
                                    {% for num in roles.paginator.page_range %}
                                        {% if roles.number == num %}
                                            <li class="page-item active">
                                                <span class="page-link">{{ num }}</span>
                                            </li>
                                        {% else %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                                            </li>
                                        {% endif %}
                                       
                                    {% endfor %}
                                    {% if roles.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ roles.next_page_number }}">
                                                suivant <!-- Icon -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="9 6 15 12 9 18" /></svg>

                                            </a>
                                        </li>
                                     
                                    {% endif %}
                                  
                                  </ul>
                                
                                </div>
                            </div>
                           
                        </div>
                        {% endif %}

                        {% if results %}
                            
                       <!-- A afficher lorsque la recherche est finis-->
                        <div class="page-header d-print-none mb-2">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h2 class="page-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24"
                                            viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                                            <circle cx="10" cy="10" r="7" />
                                            <line x1="21" y1="21" x2="15" y2="15" />
                                        </svg>
                                        Resultats trouvés pour '{{query}}'
                                    </h2>
                                    <div class="text-muted mt-1"> {{ roleSearch|length }} rôle(s) et {{ affaireSearch|length }} affaire(s)</div>
                                </div>
                            </div>
                        </div>
                            
                        <div class="space-y">                              
                            {% for role in results %} 
                            
                                 <!-- si le tableau contient des roles -->
                                {% if role.idRole %}
                                <div class="card  role-card" data-juridiction-id="{{ role.juridiction_id }}"  data-date="{{role.dateEnreg}}" data-president="{{role.president}}">
                                    <div class="row g-0">
                                        <div class="col-auto">
                                            <div class="card-body">
                                                <div class="avatar avatar-md"
                                                    style="background-image: url(./static/jobs/job-2.png)"><i class="fa fa-balance-scale"></i></div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body ps-0">
                                                <div class="row">
                                                    <div class="col">
                                                        
                                                        {% if user.is_authenticated %}
                                                            <h3 class="mb-0"><a  href="{% url 'role.detail' role.idRole %}">{{ role.colored_juridiction|safe }} - Rôle du {{role.colored_dateEnreg|safe}}</a></h3>
                                                        {% else %}
                                                            <h3 class="mb-0"><a  href="#" data-bs-toggle="modal" data-bs-target="#modal-login">{{ role.colored_juridiction|safe }} - Rôle du {{role.colored_dateEnreg|safe}}</a></h3>
                                                        {% endif %}
                                                            
                                                    </div>
                                                    <div class="col-auto fs-4 text-green">
                                                        {% if role.created_at|date:"Y-m-d" == today %}
                                                        <!-- Download SVG icon from http://tabler-icons.io/i/star -->
                                                         <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" /></svg>
                                                         Nouveau
                                                     {% endif %}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md">
                                                        <div
                                                            class="mt-3 list-inline list-inline-dots mb-0 text-secondary d-sm-block d-none">
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/user -->
                                                                <b>Président(e) :</b> {{role.colored_president|safe}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                
                                                                <b>Section :</b> {{role.colored_section|safe}}
                                                            </div>
                                                           
                                                        </div>
                                                       
                                                    </div>
                                                    <div class="col-md-auto">
                                                        <div class="mt-3 badges">
                                                           
                                                            <a href="#"
                                                                class="badge badge-outline text-secondary fw-normal badge-pill" style="font-size:small;padding: 10px;">
                                                                {% for key, value in total_affaire_items %}
                                                                    {% if key == role.id %}
                                                                    {{ value }} Affaires <br>
                                                                    {% endif %}
                                                                {% endfor %}
                                                            </a>
                                                            
                                                           
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}

                                <!-- si le tableau contient des affaires -->
                                {% if role.role_id %}
                                <div class="card">
                                    <div class="row g-0">
                                        <div class="col-auto">
                                            <div class="card-body">
                                                <div class="avatar avatar-md"
                                                    style="background-image: url(./static/jobs/job-2.png)"><i class="fa fa-suitcase"></i></div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <div class="card-body ps-0">
                                                <div class="row">
                                                    <div class="col">
                                                         {% if user.is_authenticated %}
                                                            
                                                            {% if role.colored_demandeurs and role.colored_defendeurs %}
                                                            <h3 class="mb-0"><a href="{% url 'role.detail' role.role.idRole %}">{{ role.colored_demandeurs|safe }} &nbsp;<span class="badge bg-secondary text-light">demandeur</span>&nbsp; <mark>c/</mark> {{ role.colored_defendeurs|safe }} &nbsp;<span class="badge bg-secondary text-light">defendeur</span>&nbsp;| <span class="text-info">{{ role.role.juridiction }} </span> </a></h3>
                                                            {% endif %}

                                                            {% if role.colored_appelants and role.colored_intimes %}
                                                            <h3 class="mb-0"><a href="{% url 'role.detail' role.role.idRole %}">{{role.colored_appelants|safe }} &nbsp;<span class="badge bg-secondary text-light">appelant</span>&nbsp; <mark>c/</mark> {{ role.colored_intimes|safe }} &nbsp;<span class="badge bg-secondary text-light">intimé</span>&nbsp; | <span class="text-info">{{ role.role.juridiction }} </span></a></h3>
                                                            {% endif %}
                            
                                                            {% if role.colored_prevenus and role.colored_partieCiviles %}
                                                            <h3 class="mb-0"><a href="{% url 'role.detail' role.role.idRole %}">{{role.colored_prevenus|safe }} &nbsp;<span class="badge bg-secondary text-light">prevenu</span>&nbsp; <mark>c/</mark> {{ role.colored_partieCiviles|safe }} &nbsp;<span class="badge bg-secondary text-light">partie civile</span>&nbsp; | <span class="text-info">{{ role.role.juridiction }} </span></a></h3>
                                                            {% endif %}
                                                           

                                                        {% else %}
                                                            <h3 class="mb-0"><a  href="#" data-bs-toggle="modal" data-bs-target="#modal-login">{{ role.colored_demandeurs|safe }} &nbsp;<span class="badge bg-secondary text-light">demandeur</span>&nbsp; <mark>c/</mark> {{ role.colored_defendeurs|safe }} &nbsp;<span class="badge bg-secondary text-light">defendeur</span>&nbsp; [ {{ role.colored_partie3|safe }} ]</a></h3>
                                                        {% endif %}
                                                    </div>
                                                    <div class="col-auto fs-4 text-green">
                                                        {% if role.created_at|date:"Y-m-d" == today %}
                                                        <!-- Download SVG icon from http://tabler-icons.io/i/star -->
                                                         <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" /></svg>
                                                         Nouveau
                                                     {% endif %}
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md">
                                                        <div
                                                            class="mt-3 list-inline list-inline-dots mb-0 text-secondary d-sm-block d-none">
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/user -->
                                                                <b>Numero RG/RP :</b> {{role.colored_numRg|safe}} {{role.colored_numRp|safe}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                <b>Objet :</b> {{role.colored_objet|safe}}
                                                            </div>
                                                            <div class="list-inline-item">
                                                                <!-- Download SVG icon from http://tabler-icons.io/i/license -->
                                                                
                                                                <b>Affaire au rôle du :</b> {{role.role.dateEnreg}}
                                                            </div>
                                                           
                                                        </div>
                                                       
                                                    </div>
                                                  
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {% endif %}
                                    
                             
                            {% endfor %}

                            <!-- Pagination results -->
                            <div class="card">
                                <div class="card-body">
                                  <ul class="pagination ">
                                    {% if results.has_previous %}
                                    
                                     <li class="page-item">
                                        <a class="page-link" href="?page={{ results.previous_page_number }}&q={{query}}" tabindex="-1" aria-disabled="true">
                                          <!-- Download SVG icon from http://tabler-icons.io/i/chevron-left -->
                                          <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="15 6 9 12 15 18" /></svg>
                                          précédent
                                        </a>
                                      </li>
                                    {% endif %}
                                    {% for num in results.paginator.page_range %}
                                        {% if results.number == num %}
                                            <li class="page-item active">
                                                <span class="page-link">{{ num }}</span>
                                            </li>
                                        {% else %}
                                            <li class="page-item">
                                                <a class="page-link" href="?page={{ num }}&q={{query}}">{{ num }}</a>
                                            </li>
                                        {% endif %}
                                       
                                    {% endfor %}
                                    {% if results.has_next %}
                                        <li class="page-item">
                                            <a class="page-link" href="?page={{ results.next_page_number }}&q={{query}}">
                                                suivant <!-- Icon -->
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><polyline points="9 6 15 12 9 18" /></svg>

                                            </a>
                                        </li>
                                     
                                    {% endif %}
                                  
                                  </ul>
                                
                                </div>
                            </div>
                           
                        </div>
                        {% endif %}
                        
                        {% if results|length == 0 and query|length > 0 %}
                          <h2 style="text-align: center;"><i class="fa fa-info-circle"></i> Aucun résultat trouvé pour '{{ query }}'.</h2>
                        {% endif %}
                            
                    </div>


                </div>

                <div class="col-md-2 col-lg-2 row g-3">
                    <div class="col-md-12">
                        <img src="/static/start/assets/statics/pub-anime1.gif" 
                        class="" 
                        alt="Actu 1" 
                        style="height: 657px; width: 463; object-fit: cover;">
                    </div>

                    <div class="col-md-12">
                        <img src="/static/start/assets/statics/pub-anime2.gif" 
                        class="" 
                        alt="Actu 1" 
                        style="height: 420px; width: 463; object-fit: cover;">
                    </div>

                </div>
            </div>
        </div>
    </div>

</div>
<script src="{% static 'start/assets/dist/js/virtual-select.min.js' %}"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {

            document.getElementById("link_procedure").classList.add("active");
  
    });
</script>
<script>
    VirtualSelect.init({
        ele: '#multipleSelect1',
        multiple: true,
        selectAllText: 'Tout selectionner',
        allOptionsSelectedText: 'Cours d\'appels',

    });
</script>
<script>
    VirtualSelect.init({
        ele: '#multipleSelect2',
        multiple: true,
        selectAllText: 'Tout selectionner',
        allOptionsSelectedText: 'juridictions Spécialisées',

    });
</script>
<script>
    VirtualSelect.init({
        ele: '#multipleSelect3',
        multiple: true,
        selectAllText: 'Tout selectionner',
        allOptionsSelectedText: 'Tribunaux de première instance',

    });
</script>
<script>
    VirtualSelect.init({
        ele: '#multipleSelect4',
        multiple: true,
        selectAllText: 'Tout selectionner',
        allOptionsSelectedText: 'Justice de paix',

    });
</script>
<script>
    VirtualSelect.init({
        ele: '#multipleSelect5',
        multiple: true,
        selectAllText: 'Tout selectionner',
        allOptionsSelectedText: 'Présidents',

    });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
    const checkboxes = document.querySelectorAll('.juridiction-checkbox');
    const rolesContainer = document.querySelector('#roles-container'); // Ajouter un ID autour de votre bloc d'affichage de rôles

    // Fonction pour filtrer les rôles en fonction des juridictions cochées
    function filterRoles() {
        // Récupère les ID des juridictions sélectionnées
        const selectedJuridictions = Array.from(checkboxes)
            .filter(checkbox => checkbox.checked)
            .map(checkbox => checkbox.value);

        // Parcourir chaque rôle pour voir s'il correspond aux juridictions sélectionnées
        document.querySelectorAll('.role-card').forEach(card => {
            const roleJuridictionId = card.getAttribute('data-juridiction-id');

            document.getElementById("loader").style.display = "block";  

            setTimeout(() => {
                
                // Si aucune case n'est cochée, affiche toutes les cartes
                if (selectedJuridictions.length === 0) {
                    card.style.display = 'block';
                    document.getElementById("loader").style.display = "none";

                } else {
                    // Sinon, affiche uniquement les cartes correspondant aux juridictions sélectionnées
                    if (selectedJuridictions.includes(roleJuridictionId)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                    document.getElementById("loader").style.display = "none";

                }
                
            }, 2000);

           
        });
    }

    // Ajoute un écouteur d'événement de changement sur chaque case à cocher
    checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', filterRoles);
    });

    // Filtrage initial au chargement de la page
    //filterRoles();

    const selectElement1 = document.getElementById("multipleSelect1");
    const selectElement2 = document.getElementById("multipleSelect2");
    const selectElement3 = document.getElementById("multipleSelect3");
    const selectElement4 = document.getElementById("multipleSelect4");

    // Fonction pour filtrer les rôles en fonction des juridictions sélectionnées dans le select multiple
    function filterRolesBySelect(selectElement) {
        console.log(selectElement);
        
        document.getElementById("loader").style.display = "block";  

        // Parcourir chaque rôle pour voir s'il correspond aux juridictions sélectionnées
        document.querySelectorAll('.role-card').forEach(card => {
            const roleJuridictionId = card.getAttribute('data-juridiction-id');

            setTimeout(() => {
                
                // Si aucune case n'est cochée, affiche toutes les cartes
                if (selectElement.value.length === 0) {

                    document.getElementById("loader").style.display = "none";
                    card.style.display = 'block';

                } else {

                    document.getElementById("loader").style.display = "none";

                    // Sinon, affiche uniquement les cartes correspondant aux juridictions sélectionnées
                    if (selectElement.value.some(id => id === roleJuridictionId)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }

                }
                
            }, 2000);
        });
    }

    // Ajoute un écouteur d'événement de changement sur le select multiple
    selectElement1.addEventListener('change', () => filterRolesBySelect(selectElement1));
    selectElement2.addEventListener('change', () => filterRolesBySelect(selectElement2));
    selectElement3.addEventListener('change', () => filterRolesBySelect(selectElement3));
    selectElement4.addEventListener('change', () => filterRolesBySelect(selectElement4));

    // Sélection de l'élément du champ de date
    const dateInput = document.getElementById("filtreDate");

    // Fonction de filtrage par date avec animation de chargement
    function filterRolesByDate() {

        // Fonction pour formater la date
        function formatDate(dateString) {
            const date = new Date(dateString);

            // Options pour afficher le jour, le mois et l'année en français
            const options = { day: 'numeric', month: 'long', year: 'numeric' };
            
            // Convertir la date en format lisible (ex. 22 novembre 2024)
            return date.toLocaleDateString('fr-FR', options);
        }

        // Exemple d'utilisation
        const selectedDate = dateInput.value;
        const formattedDate = formatDate(selectedDate);
        console.log(formattedDate);

        document.getElementById("loader").style.display = "block";

         // Parcourir chaque carte de rôle pour filtrer en fonction de la date
        document.querySelectorAll(".role-card").forEach(card => {
        const cardDate = card.getAttribute("data-date");

            setTimeout(() => {
    
                    // Afficher/Masquer les cartes selon la date sélectionnée
                    if (formattedDate === cardDate) {
                        card.style.display = "block";
                    } else {
                        card.style.display = "none";
                    }
            
                // Cacher le loader après le filtrage
                document.getElementById("loader").style.display = "none";

            }, 2000);

         });
    }

    // Ajouter un écouteur de changement pour le champ de date
    dateInput.addEventListener("change", filterRolesByDate);

    // Sélection des éléments des champs de date
    const startDateInput = document.getElementById("start-date");
    const endDateInput = document.getElementById("end-date");

    // Fonction pour convertir une date française (ex. "12 novembre 2024") en objet Date
    function parseFrenchDate(frenchDate) {
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        return new Date(new Intl.DateTimeFormat('fr-FR', options).format(new Date(frenchDate)));
    }

    // Fonction pour filtrer en fonction des dates de début et de fin
    function filterRolesByDateRange() {
        const startDate = new Date(startDateInput.value);
        const endDate = new Date(endDateInput.value);

        document.getElementById("loader").style.display = "block";

        setTimeout(() => {
            document.querySelectorAll(".role-card").forEach(card => {
                const cardDateStr = card.getAttribute("data-date");
                const cardDate = parseFrenchDate(cardDateStr); // Conversion de la date française en objet Date

                // Afficher la carte uniquement si la date est comprise entre startDate et endDate
                if (!isNaN(startDate) && !isNaN(endDate)) {
                    if (cardDate >= startDate && cardDate <= endDate) {
                        card.style.display = "block";
                    } else {
                        card.style.display = "none";
                    }
                } else {
                    // Si l'une des dates est manquante, affichez toutes les cartes
                    card.style.display = "block";
                }
            });

            document.getElementById("loader").style.display = "none";
        }, 2000);
    }

    // Ajouter un écouteur de changement pour chaque champ de date
    startDateInput.addEventListener("change", filterRolesByDateRange);
    endDateInput.addEventListener("change", filterRolesByDateRange);

    const selectElement5 = document.getElementById("multipleSelect5");

    function filterRolesBySelectPresident(selectElement) {
        
        document.getElementById("loader").style.display = "block";  

        // Parcourir chaque rôle pour voir s'il correspond aux juridictions sélectionnées
        document.querySelectorAll('.role-card').forEach(card => {
            const president = card.getAttribute('data-president');

            setTimeout(() => {
                
                // Si aucune case n'est cochée, affiche toutes les cartes
                if (selectElement.value.length === 0) {

                    document.getElementById("loader").style.display = "none";
                    card.style.display = 'block';

                } else {

                    document.getElementById("loader").style.display = "none";

                    // Sinon, affiche uniquement les cartes correspondant aux juridictions sélectionnées
                    if (selectElement.value.some(id => id === president)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }

                }
                
            }, 2000);
        });
    }

    selectElement5.addEventListener('change', () => filterRolesBySelectPresident(selectElement5));


    });

</script>



{% endblock %}