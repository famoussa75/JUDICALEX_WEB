{% extends 'start/base.html' %}


{% block title %}Details du role{% endblock title %}

{% block content %}
{% load static %}

{% load user_extras %}



<div class="page-wrapper">
    <div class="mb-4 d-flex flex-wrap align-items-center gap-2 px-3 py-2"
        style="background: var(--Bleu, #143642); border-radius: 4px;">

        <span class="text-white fw-bold" style="font-family: Jost; font-size: 1rem;">
            Procédures
        </span>

        <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="0.8em" height="1.2em" viewBox="0 0 10 17" fill="white">
            <path d="M2.22229 16.5L7.77771 10.7857L10 8.5L7.77771 6.21433L2.22229 0.5L0 2.78567L5.55543 8.5L0 14.2143L2.22229 16.5Z"/>
        </svg>

        <a href="{% url 'role.index' %}" class="text-decoration-none">
            <span class="text-white fw-bold" style="font-family: Jost; font-size: 1rem;">
                Rôles d'audiences
            </span>
        </a>

        <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="0.8em" height="1.2em" viewBox="0 0 10 17" fill="white">
            <path d="M2.22229 16.5L7.77771 10.7857L10 8.5L7.77771 6.21433L2.22229 0.5L0 2.78567L5.55543 8.5L0 14.2143L2.22229 16.5Z"/>
        </svg>

        <span class="fw-bold" style="color: var(--Jaune, #DFB23D); font-family: Jost; font-size: 1rem;">
            Rôle d'audience de fond du {{role.dateEnreg}}
        </span>
    </div>

    <div class="page-body">
        <div class="container-fluid">
            <div class="row g-3">
              
                <div class="col-12 animate-bottom">
                    <div class="card card-body shadow-sm">
                  
                      <!-- En-tête du document -->
                      <div class=" border-bottom pb-3 mb-4">
                        <div class="row align-items-center text-center text-md-start">
                          
                        <!-- Bloc gauche -->
                          <div class="col-12 col-md-4 text-center align-self-start">
                            <h4 class="fw-bold mb-1 text-uppercase">RÉPUBLIQUE DE GUINÉE</h4>
                            <p class="mb-1 text-muted small fst-italic">Travail - Justice - Solidarité</p>
                            <h6 class="fw-bold mb-1 text-uppercase">Ministère de la Justice et des Droits de l'Homme</h6>
                            <p class="fw-semibold text-dark mb-0">{{ role.get_section_display }}</p>
                          </div>


                          <div class="col-12 col-md-4">
                              <!-- Infos audience -->
                            <div class="text-center">
                              <p class="h2 text-decoration-underline mb-2">
                                COUR D'APPEL DE CONAKRY
                              </p>
                              <p class="mb-1 text-muted">Tribunal de Commerce de Conakry</p>
                              <p class="mb-2">*&nbsp;&nbsp;*&nbsp;&nbsp;*</p>
                              <p class="h3 text-decoration-underline mb-2">
                                RÔLE D'AUDIENCE DE FOND DU {{ role.dateEnreg }}
                              </p>
                              <p class="h3 text-decoration-underline mb-2">COMPOSITION DU TRIBUNAL</p>
                              <p class="mb-1"><span class="fw-bold">PRÉSIDENT(E) :</span> {{ role.president }}</p>
                              <p class="mb-1"><span class="fw-bold">JUGES CONSULAIRES :</span> {{ role.juge }}</p>
                              <p class="mb-1"><span class="fw-bold">GREFFIER(E) :</span> {{ role.greffier }}</p>
                            </div>
                          </div>

                        <!-- Bloc droit -->
                          <div class="col-12 col-md-4 text-center text-md-end align-self-start mt-3 mt-md-0">
                            <!-- Bouton de téléchargement PDF -->
                            <a href="{% url 'role_detail.export_pdf' %}?q={{ request.GET.q }}&role_id={{ role.id }}" 
                                class="btn btn-outline-warning btn-sm mt-2 px-3 py-2 fw-semibold text-dark d-inline-flex align-items-center" 
                                style="border:2px solid #DFB23D; border-radius:10px; transition: all 0.3s ease;"
                                target="_blank"
                                onmouseover="this.style.backgroundColor='#DFB23D'; this.style.color='white';"
                                onmouseout="this.style.backgroundColor=''; this.style.color='black';">
                              <i class="bi bi-file-earmark-pdf-fill me-2 fs-5 text-danger"></i>
                              Télécharger en PDF
                            </a>
                        
                        
                          </div>


                        </div>
                      </div>
                  
                      <!-- Actions + Recherche -->
                      <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
                        {% if request.user|has_group:"Contributeur" %}
                        <div class="dropdown mb-2">
                          <button class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                            Actions
                          </button>
                          <div class="dropdown-menu dropdown-menu-end">
                            <a href="#" class="dropdown-item" id="suivre_affaire">
                              <i class="fas fa-eye"></i> Suivre
                            </a>
                            <a href="#" class="dropdown-item" id="ne_pas_suivre_affaire">
                              <i class="fas fa-eye-slash"></i> Ne plus suivre
                            </a>
                          </div>
                        </div>
                        {% endif %}
                  
                        <form class="d-flex mb-2" method="get">
                          <input type="text" class="form-control form-control-sm me-2"
                                 name="search" id="recherche-objet" placeholder="Rechercher un objet...">
                          <button class="btn btn-sm btn-primary">Rechercher</button>
                        </form>
                      </div>
                  
                      <!-- Table responsive -->
                      <div class="table-responsive">
                        <table class="table table-bordered table-hover align-middle">
                          <thead class="table-light text-center">
                            <tr>
                              {% if request.user|has_group:"Contributeur" %}
                              <th><input id="select-all" class="form-check-input" type="checkbox"></th>
                              {% endif %}
                              <th>N°</th>
                              <th>NUA</th>
                              <th>RG</th>
                              <th>Demandeurs</th>
                              <th>Défendeurs</th>
                              <th>Objet</th>
                              <th>Décisions</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% regroup page_obj by categorie as grouped_affaires %}
                            {% for group in grouped_affaires %}
                            <tr class="table-active text-center">
                                <td colspan="8">
                                    <b class="text-primary">
                                        {% if group.grouper == 'Nouvelles Affaires' %}
                                            ⚖️ {{ group.grouper }}
                                        {% elif group.grouper == 'Affaires Encours' %}
                                            ⏳ {{ group.grouper }}
                                        {% else %}
                                            ⚖️ {{ group.grouper }}
                                        {% endif %}
                                    </b>
                                </td>
                            </tr>
                            {% for affaire in group.list %}
                            <tr>
                              {% if request.user|has_group:"Contributeur" %}
                              <td>
                                <input class="form-check-input me-2 row-checkbox" type="checkbox" value="{{ affaire.id }}">
                                {% for a in affaireSuivis %}
                                  {% if a.affaire_id == affaire.id %}
                                    <span class="badge bg-success">Déjà suivi</span>
                                  {% endif %}
                                {% endfor %}
                              </td>
                              {% endif %}
                              <td class="text-center">{{ affaire.numOrdre }}</td>
                              <td class="text-center"><b>{{ affaire.numAffaire }}</b></td>
                              <td class="text-center">{{ affaire.numRg }}</td>
                              <td>{{ affaire.demandeurs }}</td>
                              <td>{{ affaire.defendeurs }}</td>
                              <td>{{ affaire.objet }}</td>
                              <td class="text-center">
                                <a href="{% url 'affaires.details' affaire.idAffaire %}" class="btn btn-sm btn-outline-primary">
                                  Décisions <i class="fas fa-arrow-right"></i>
                                </a>
                              </td>
                            </tr>
                            {% endfor %}
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                  
                      <!-- Pagination -->
                      <nav class="d-flex justify-content-center my-3">
                        <ul class="pagination pagination-sm">
                          {% if page_obj.has_previous %}
                          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Précédent</a></li>
                          {% else %}
                          <li class="page-item disabled"><span class="page-link">Précédent</span></li>
                          {% endif %}
                  
                          {% for num in page_obj.paginator.page_range %}
                          {% if page_obj.number == num %}
                          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
                          {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                          <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                          {% endif %}
                          {% endfor %}
                  
                          {% if page_obj.has_next %}
                          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Suivant</a></li>
                          {% else %}
                          <li class="page-item disabled"><span class="page-link">Suivant</span></li>
                          {% endif %}
                        </ul>
                      </nav>
                  
                      <!-- Footer -->
                      <div class="row mt-4">
                        <div class="col-12 text-end">
                          <p class="small mb-0">Conakry, {{ role.created_at|date:"j F Y" }}</p>
                          <address class="text-muted mb-0" style="font-size: 0.85rem;">
                            Le/La Greffier(e)
                          </address>
                        </div>
                      </div>
                  
                    </div>
                  </div>
                  
            </div>
        </div>
    </div>

</div>

<script>
  {% if not user.is_authenticated %}
  document.addEventListener("DOMContentLoaded", function () {
  
    let formSubmitted = false;
    let switchingModal = false; // permet la navigation entre les modals
  
    // Sélection des modals
    const loginModalEl = document.getElementById('modal-login');
    const registerModalEl = document.getElementById('modal-register');
  
    // Initialiser les modals Bootstrap avec blocage
    function initProtectedModal(modalEl) {
      if (!modalEl) return null;
      const modal = new bootstrap.Modal(modalEl, {
        backdrop: 'static',
        keyboard: false
      });
  
      // Bloquer la fermeture sauf si on change de modal ou on a soumis un form
      modalEl.addEventListener('hide.bs.modal', function (e) {
        if (!formSubmitted && !switchingModal) {
          e.preventDefault();
        }
      });
  
      return modal;
    }
  
    const loginModal = initProtectedModal(loginModalEl);
    const registerModal = initProtectedModal(registerModalEl);
  
    // 🔹 Ouvre automatiquement le login au démarrage
    if (loginModal) {
      setTimeout(() => loginModal.show(), 300);
    }
  
    // 🔹 Navigation entre les modals
    document.querySelectorAll('[data-bs-target="#modal-register"], [data-bs-target="#modal-login"]').forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
  
        const targetSelector = this.getAttribute('data-bs-target');
        const targetModalEl = document.querySelector(targetSelector);
  
        if (!targetModalEl) return;
  
        // Autoriser la fermeture pour le changement
        switchingModal = true;
  
        // Fermer tous les modals visibles
        [loginModalEl, registerModalEl].forEach(m => {
          const instance = bootstrap.Modal.getInstance(m);
          if (instance) instance.hide();
        });
  
        // Ouvrir le modal cible après une courte pause
        setTimeout(() => {
          const targetModal = bootstrap.Modal.getOrCreateInstance(targetModalEl);
          targetModal.show();
          switchingModal = false; // on désactive la navigation spéciale
        }, 300);
      });
    });
  
    // 🔹 Fermer les modals uniquement après soumission d’un formulaire
    document.querySelectorAll("#modal-login form, #modal-register form").forEach(form => {
      form.addEventListener("submit", function () {
        formSubmitted = true;
        [loginModalEl, registerModalEl].forEach(m => {
          const instance = bootstrap.Modal.getInstance(m);
          if (instance) instance.hide();
        });
      });
    });
  
  });
  {% endif %}
</script>
  

<script>
    document.addEventListener("DOMContentLoaded", function () {

            document.getElementById("link_procedure").classList.add("active");
  
    });
</script>

<script>

    function updateRole(name,value,type) {
        $('#field').val('').attr('name', '').attr('type', '');
        $('#field').val(value).attr('name', name).attr('type', type);

    }

    function updateAffaire(name,value,type,idAffaire) {
        $('#field').val('').attr('name', '').attr('type', '');
        $('#idAffaire').val('');

        $('#field').val(value).attr('name', name).attr('type', type);
        $('#idAffaire').val(idAffaire);
    }
    
</script>


{% endblock %}