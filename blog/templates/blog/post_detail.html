
{% extends 'start/base.html' %}


{% block title %}Blog{% endblock title %}

{% block content %}
{% load static %}
{% load social_extras %}
{% load user_extras %}

<style>
    .post-preview {
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease-in-out;
        margin-bottom: 30px;
    }

    .post-preview:hover {
        transform: translateY(-5px);
    }

    .post-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-top: 15px;
        margin-bottom: 10px;
    }

    .post-subtitle {
        font-size: 1.2rem;
        color: #6c757d;
    }

    .post-meta {
        font-size: 0.9rem;
        color: #adb5bd;
    }

    .post-image {
        width: 100%;
        height: auto;
        max-height: 300px; /* Limite la hauteur maximale de l'image */
        border-radius: 8px;
        object-fit: cover; /* Garde l'image centrée si elle dépasse la hauteur */
        border-radius: 8px;
    }

    .content-section {
        padding: 15px;
    }
</style>


<div class="page-wrapper" style="background-color: white;">
    <!-- <div style="display: flex;  width: 100%; padding: 7px 1210px 8px 17px; align-items: center; background: var(--Bleu, #143642);">
         <span style="color: var(--Blanc, #FFF); font-family: Jost; font-size: 16px; font-style: normal; font-weight: 700; line-height: normal;">
            Divers
        </span>
        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="17" viewBox="0 0 10 17" fill="none">
            <path d="M2.22229 16.5L7.77771 10.7857L10 8.5L7.77771 6.21433L2.22229 0.5L0 2.78567L5.55543 8.5L0 14.2143L2.22229 16.5Z" fill="white"/>
        </svg> 
        <span style="color: var(--Jaune, #DFB23D); font-family: Jost; font-size: 16px; font-style: normal; font-weight: 700; line-height: normal;">
            Actualités
        </span>
      </div> 
    -->

     <!-- PUB HAUT DE PAGE -->
     {% include 'start/partials/pub_header.html' %}

     <!-- ACTUALITÉS SECTION -->

    <div class="container">

     

        <div class="col-md-12 row">
       
            <div class="col-md-9">
                <h1 class="text-left mb-3" 
                    style="color: var(--Bleu, #143642); font-family: Jost; font-size: 28px; font-weight: 700;">
                    {{ post.title }}
                </h1>
                <div class="row g-4 mb-4">
                
                    <!-- Carte Actualité 1 -->
                    <div class="col-md-12">
                        <div class="card" style="border: none; box-shadow: none;">
                        <img src="{{ post.image.url }}" 
                            class="card-img-top" 
                            alt="Actu 1" 
                            style="height: 500px; object-fit: cover; border-radius: 15px; overflow: hidden;">
                                <!-- Ligne Creator + Time -->
                        
                        <div class="">
                            {% if post.author|has_group:"Contributeur" %}
                            <div class="d-flex justify-content-between align-items-center mb-4 mt-2">
                                <span style="font-family: Jost; font-weight: 700; color: #143642;">
                                    {% if post.author.photo %}
                                        <img src="{{ post.author.photo.url }}"
                                            alt="{{ post.author.username }}"
                                            style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover; margin-right: 5px; border: 1px solid">
                                    {% elif post.author|social_avatar %}
                                        <img src="{{ post.author|social_avatar }}"
                                            alt="{{ post.author.username }}"
                                            style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover; margin-right: 5px; border: 1px solid">
                                    {% else %}
                                        <img src="{% static 'start/assets/statics/logo-icon.png' %}"
                                            alt="{{ post.author.username }}"
                                            style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover; margin-right: 5px; border: 1px solid">
                                    {% endif %}

                                    {{ post.author.first_name }} {{ post.author.last_name }}
                                </span>
                                <a href="#" style="color: gray; font-weight: 700;">Il y'a {{ post.created_at|timesince }} </a>
                                <!-- Photo de profil -->  
                            </div>
                            {% else %}
                            <div class="d-flex justify-content-between align-items-center mb-4 mt-2">
                                <span style="font-family: Jost; font-weight: 700; color: #143642;">

                                        <img src="{% static 'start/assets/statics/logo-icon.png' %}"
                                            alt="{{ post.author.username }}"
                                            style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover; margin-right: 5px; border: 1px solid">

                                Judicalex Guinée
                                </span>
                                <a href="#" style="color: gray; font-weight: 700;">Il y'a {{ post.created_at|timesince }} </a>
                                <!-- Photo de profil -->  
                            </div>

                            {% endif %}
                            <p class="card-text" style="font-family: Jost; font-size: 15px; color: #555;">
                                {{ post.content|safe }}
                            </p>
                            
                        </div>
                        </div>
                    </div>
            
                </div>

                 <!-- Section des commentaires -->
                 <h3 style="font-family: Jost; font-weight: 700; color: #143642;"><i class="fa fa-comments" ></i> Commentaires</h3>
                 <div class="comments">
                    {% for comment in comments %}
                        <div class="comment mb-3 p-2 bg-light rounded">
                            <p>
                                <strong> 
                                    <span style="font-family: Jost; font-weight: 700; color: #143642;">
                                        {% if comment.user.photo %}
                                            <img src="{{ comment.user.photo.url }}"
                                                alt="{{ comment.user.username }}"
                                                style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover; margin-right: 5px; border: 1px solid">
                                        {% elif comment.author|social_avatar %}
                                            <img src="{{ comment.user|social_avatar }}"
                                                alt="{{ post.author.username }}"
                                                style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover; margin-right: 5px; border: 1px solid">
                                        {% else %}
                                            <img src="https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png"
                                                alt="{{ comment.user.username }}"
                                                style="width: 34px; height: 34px; border-radius: 50%; object-fit: cover; margin-right: 5px; border: 1px solid">
                                        {% endif %}

                                    </span> 
                                {{ comment.user.first_name }} {{ comment.user.last_name }}</strong> 
                                - {{ comment.created_at }}
                            </p>
                
                            <div id="comment-text-{{ comment.id }}">
                                <p>{{ comment.content }}</p>
                            </div>
                
                            {% if request.user == comment.user %}
                            <div class="mt-2 d-flex justify-content-end gap-2">
                                <!-- Bouton Modifier -->
                                <button class="btn btn-sm" onclick="toggleForm({{ comment.id }})" title="Modifier">
                                    <i class="bi bi-pencil"></i>
                                </button>
                            
                                <!-- Bouton Supprimer -->
                                <button class="btn btn-sm " data-bs-toggle="modal" data-bs-target="#deleteModal{{ comment.id }}" title="Supprimer">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                            
                                <!-- Modal de confirmation -->
                                <div class="modal fade" id="deleteModal{{ comment.id }}" tabindex="-1" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title">Confirmation de suppression</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
                                            </div>
                                            <div class="modal-body">
                                                Voulez-vous vraiment supprimer ce commentaire ?
                                                <blockquote class="blockquote mt-2">
                                                    <p class="mb-0">{{ comment.content }}</p>
                                                </blockquote>
                                            </div>
                                            <div class="modal-footer">
                                                <form method="post" action="{% url 'comment_delete' comment.id %}">
                                                    {% csrf_token %}
                                                    <button type="submit" class="btn btn-danger">Oui, supprimer</button>
                                                </form>
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <!-- Formulaire d’édition caché -->
                                <form method="post" 
                                      action="{% url 'comment_edit' comment.id %}" 
                                      class="mt-2 d-none" 
                                      id="comment-form-{{ comment.id }}">
                                    {% csrf_token %}
                                    <textarea name="content" class="form-control" rows="2">{{ comment.content }}</textarea>
                                    <button type="submit" class="btn btn-success btn-sm mt-1">Enregistrer</button>
                                    <button type="button" class="btn btn-secondary btn-sm mt-1" onclick="toggleForm({{ comment.id }})">Annuler</button>
                                </form>
                            {% endif %}
                        </div>
                    {% empty %}
                        <p>Aucun commentaire pour l'instant. Soyez le premier à commenter !</p>
                    {% endfor %}
                </div>
                
                 <!-- Formulaire d'ajout de commentaire -->
                 {% if request.user.is_authenticated %}
                     <h4><i class="fa fa-plus-circle"></i> Ajouter un commentaire</h4>
                     <form method="POST">
                         {% csrf_token %}
                         {{ form.as_p }}
                         <button type="submit" class="btn btn-primary">Envoyer</button>
                     </form>
                 {% else %}
                     <p>Vous devez <a href="#" data-bs-toggle="modal" data-bs-target="#modal-login">vous connecter</a> pour commenter cet article.</p>
                 {% endif %}
                 <hr>

       
            </div>
            
             <!-- PUB LATERAL -->
             <div class="col-md-3">
                {% include 'start/partials/pub_lateral.html' %}
            </div>

        </div>
        <div class="col-md-12 mt-4 mb-5 row">

            <h2 class="blog-post-title" style="font-family: Jost; font-weight: 700; color: #143642;">Articles similaires</h2>
            <p class="blog-post-meta" style="font-family: Jost; font-size: 15px; color: #555;">Articles dans la categorie <a href="#">{{ post.category }}</a></p>
            
            
            <div id="similarPostsCarousel" class="carousel slide" data-bs-ride="carousel">

                <div class="carousel-inner">
              
                  {% for post in similar_posts %}
                    {% if forloop.counter0|divisibleby:3 %}
                      <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <div class="row">
                    {% endif %}
              
                    {% include "blog/partials/post_single_mini.html" %}
              
                    {% if forloop.counter|divisibleby:3 or forloop.last %}
                        </div>
                      </div>
                    {% endif %}
                  {% endfor %}
              
                </div>
              
                <!-- Contrôles -->
                <button class="carousel-control-prev" type="button" data-bs-target="#similarPostsCarousel" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#similarPostsCarousel" data-bs-slide="next">
                  <span class="carousel-control-next-icon"></span>
                </button>
            </div>
              
        
        </div>

    </div>
   
</div>

<!-- Lien vers Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {

            document.getElementById("link_actualite").classList.add("active");
  
    });
</script>

<script>
    function toggleForm(id) {
        let form = document.getElementById("comment-form-" + id);
        let text = document.getElementById("comment-text-" + id);
    
        if (form.classList.contains("d-none")) {
            form.classList.remove("d-none");
            text.classList.add("d-none");
        } else {
            form.classList.add("d-none");
            text.classList.remove("d-none");
        }
    }
    </script>

{% endblock %}